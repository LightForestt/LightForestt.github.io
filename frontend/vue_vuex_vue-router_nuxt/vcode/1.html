<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>其实在 new vue()之前已经为创建 vue 实例做了很多前置性工作，大致可以分为以下几点 |  learning 🤔</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="ing">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.8a3e4be4.js" as="script"><link rel="preload" href="/assets/js/2.b1c453a7.js" as="script"><link rel="preload" href="/assets/js/43.f3f083c8.js" as="script"><link rel="prefetch" href="/assets/js/10.a1484098.js"><link rel="prefetch" href="/assets/js/11.b70f6910.js"><link rel="prefetch" href="/assets/js/12.aa4e4756.js"><link rel="prefetch" href="/assets/js/13.24822fb7.js"><link rel="prefetch" href="/assets/js/14.ba83d711.js"><link rel="prefetch" href="/assets/js/15.ce56a167.js"><link rel="prefetch" href="/assets/js/16.510d6dca.js"><link rel="prefetch" href="/assets/js/17.41412f1e.js"><link rel="prefetch" href="/assets/js/18.8143a9b6.js"><link rel="prefetch" href="/assets/js/19.dfc55bfb.js"><link rel="prefetch" href="/assets/js/20.d149cd7c.js"><link rel="prefetch" href="/assets/js/21.282166c1.js"><link rel="prefetch" href="/assets/js/22.c878d45b.js"><link rel="prefetch" href="/assets/js/23.7ea9cee2.js"><link rel="prefetch" href="/assets/js/24.0a65f294.js"><link rel="prefetch" href="/assets/js/25.cf952e8f.js"><link rel="prefetch" href="/assets/js/26.fa6a6b52.js"><link rel="prefetch" href="/assets/js/27.986b9955.js"><link rel="prefetch" href="/assets/js/28.cd904e4d.js"><link rel="prefetch" href="/assets/js/29.22c8bd30.js"><link rel="prefetch" href="/assets/js/3.0b8b26d0.js"><link rel="prefetch" href="/assets/js/30.f974ab27.js"><link rel="prefetch" href="/assets/js/31.c099b303.js"><link rel="prefetch" href="/assets/js/32.eb8d6a86.js"><link rel="prefetch" href="/assets/js/33.77cf9e9a.js"><link rel="prefetch" href="/assets/js/34.67e1bc26.js"><link rel="prefetch" href="/assets/js/35.acda1906.js"><link rel="prefetch" href="/assets/js/36.8f514314.js"><link rel="prefetch" href="/assets/js/37.75d78737.js"><link rel="prefetch" href="/assets/js/38.e372ed82.js"><link rel="prefetch" href="/assets/js/39.31d074d8.js"><link rel="prefetch" href="/assets/js/4.e7c996f5.js"><link rel="prefetch" href="/assets/js/40.a0159801.js"><link rel="prefetch" href="/assets/js/41.633bb894.js"><link rel="prefetch" href="/assets/js/42.2ef5b25c.js"><link rel="prefetch" href="/assets/js/44.e18663a3.js"><link rel="prefetch" href="/assets/js/45.0853c943.js"><link rel="prefetch" href="/assets/js/46.bb71b1df.js"><link rel="prefetch" href="/assets/js/47.806d670b.js"><link rel="prefetch" href="/assets/js/48.9a81b491.js"><link rel="prefetch" href="/assets/js/49.cc728521.js"><link rel="prefetch" href="/assets/js/5.6eff8140.js"><link rel="prefetch" href="/assets/js/50.64a8e83d.js"><link rel="prefetch" href="/assets/js/51.9125457b.js"><link rel="prefetch" href="/assets/js/52.17eb17a0.js"><link rel="prefetch" href="/assets/js/6.17d5dd20.js"><link rel="prefetch" href="/assets/js/7.576da1bf.js"><link rel="prefetch" href="/assets/js/8.6fffe5ac.js"><link rel="prefetch" href="/assets/js/9.6ab3dd2a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> learning 🤔</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>frontend</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>html</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>vuejs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/1.html" aria-current="page" class="active sidebar-link">new vue()之前都发生了什么？（一）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/2.html" class="sidebar-link">new Vue(options) 中的options合并处理（二）</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/3.html" class="sidebar-link">在new Vue(options)中是如何为options进行初始化（三）</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/4.html" class="sidebar-link">initState与响应式原理（四）</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/5.html" class="sidebar-link">从$mount到虚拟dom（五）</a></li><li><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/diff.html" class="sidebar-link">diff 源码 注释版</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>threejs</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>backend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>basic</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="其实在-new-vue-之前已经为创建-vue-实例做了很多前置性工作-大致可以分为以下几点"><a href="#其实在-new-vue-之前已经为创建-vue-实例做了很多前置性工作-大致可以分为以下几点" class="header-anchor">#</a> 其实在 new vue()之前已经为创建 vue 实例做了很多前置性工作，大致可以分为以下几点</h3> <ol><li>initMixin</li> <li>stateMixin</li> <li>eventMixin</li> <li>lifecycleMixin</li> <li>renderMixin</li> <li>initGlobalAPI</li> <li>createPatchFunction</li> <li>初始化 config 和校验相关 map-funtion</li> <li>安装平台相关的全局指令和组件</li> <li>创建模版编译器 compiler</li></ol> <h4 id="initmixin"><a href="#initmixin" class="header-anchor">#</a> initMixin</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>初始化创建 vue 实例的方法，在<code>new vue()</code>传入的 options 就将作为这个方法的参数传入。</li> <li>不单单是外部调用，还存在 vue 内部生成子组件的时候，也同样会通过 init 方法去创建子组件的 vm 实例。</li></ul> <h4 id="statemixin"><a href="#statemixin" class="header-anchor">#</a> stateMixin</h4> <div class="language-js extra-class"><pre class="language-js"><code>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$data'</span><span class="token punctuation">,</span> dataDef<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$props'</span><span class="token punctuation">,</span> propsDef<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$set <span class="token operator">=</span> set
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">delete</span> <span class="token operator">=</span> del
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$watch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre></div><ul><li>代理<code>_data</code>到<code>$data</code>上去，作为<code>Vue</code>的原型属性，用户可以通过<code>this.$data</code>访问数据模型。</li> <li>代理<code>_props</code>到<code>$props</code>上去，同<code>$data</code>。</li> <li>安装响应式的对象操作方法 <code>$set $delete</code>，这些方法提供给用户去做对象或者数组属性的删除，添加。</li> <li>安装响应式对象监听方法 <code>$watch</code>,给用户一个入口在数据变化之后触发想要做的事。</li></ul> <h4 id="eventmixin"><a href="#eventmixin" class="header-anchor">#</a> eventMixin</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$on</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$off</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$emit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$once</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p>安装事件相关方法,父子组件通信的方法：</p> <ul><li>$on 往当前 vm 的事件中心 push 一个事件 也就是侦听一个事件</li> <li>$once 往当前vm的事件中心push一个事件,当前事件执行后立即$off</li> <li>$emit 触发事件中心中的某个事件</li> <li>$off 从事件中心中删除某个事件</li></ul> <h4 id="lifecyclemixin"><a href="#lifecyclemixin" class="header-anchor">#</a> lifecycleMixin</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> hydrating</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$destroy</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p>初始化生命周期相关方法：</p> <ul><li>vm._update 是实例的一个私有方法，它被调用的时机有 2 个，一个是首次渲染，一个是数据更新的时候；_update 方法的作用是把 VNode 渲染成真实的 DOM，_update 的核心就是调用 vm.__patch__ 方法，这个方法实际上在不同的平台，比如 web 和 weex 上的定义是不一样的。</li> <li>vm.$forceUpdate 让当前组件的渲染 watcher 去执行一次 update 操作，重新渲染视图。</li> <li>vm.$destory 清空事件中心，从组件关系中删除当前vm，关闭当前组件的渲染watcher，当前$data.__ob__.vm 计数器减 1，标记当前 vm 为销毁状态，patch 一个 null 替换原 vnode，执行用户传入的 destoryd 钩子。</li></ul> <h4 id="rendermixin"><a href="#rendermixin" class="header-anchor">#</a> renderMixin</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">installRenderHelpers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$nextTick</span>  <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_render</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p>初始化渲染 vnode 的相关方法：</p> <ul><li>installRenderHelpers 安装渲染工具函数，大多数服务于编译器编译出来的代码，其中的方法包括
<blockquote><ul><li>target._o = markOnce; 标记 v-once</li> <li>target._n = toNumber; 转换成 Number 类型</li> <li>target._s = toString; 转换成字符串</li> <li>target._l = renderList; 渲染 v-for</li> <li>target._t = renderSlot; 渲染普通插槽和作用域插槽</li> <li>target._q = looseEqual; 宽松比较</li> <li>target._i = looseIndexOf; 宽松 indexof</li> <li>target._m = renderStatic; 通过 staticRenderFns 渲染静态节点</li> <li>target._f = resolveFilter; 获取过滤器</li> <li>target._k = checkKeyCodes; 检查键盘事件 keycode</li> <li>target._b = bindObjectProps; 处理 v-bind='{}'到 vnodedata 上</li> <li>target._v = createTextVNode; 创建文本 vnode</li> <li>target._e = createEmptyVNode; 创建空 vnode</li> <li>target._u = resolveScopedSlots; 获取作用域插槽</li> <li>target._g = bindObjectListeners; 处理 v-on='{}'到 vnodedata 上</li> <li>target._d = bindDynamicKeys; 处理动态属性名</li> <li>target._p = prependModifier; 处理修饰符</li></ul></blockquote></li> <li>vm.$nextTick 工具方法 封装了 nextTick 在下个时间循环执行某个事件</li> <li>vm._render 调用编译传入的 render 函数或者是用户手写的 render 函数，生成用于 patch 的 vnode</li></ul> <h4 id="initglobalapi"><a href="#initglobalapi" class="header-anchor">#</a> initGlobalAPI</h4> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> <span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span>util <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token string">'filter'</span><span class="token punctuation">,</span><span class="token string">'component'</span><span class="token punctuation">,</span><span class="token string">'directive'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span>Vue<span class="token punctuation">[</span>item<span class="token operator">+</span><span class="token string">'s'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre></div><ul><li>Vue.config 提供全局访问的 config 用以配置 Vue.config</li> <li>Vue.util 提供全局工具集</li> <li>Vue.set vm.$set</li> <li>Vue.delete vm.$delete</li> <li>Vue.nextTick vm.$nextTick</li> <li>Vue.observable 初始化定义响应式的数据的方法</li> <li>Vue.extend 初始化组件构造器方法</li> <li><code>['filter','component','directive'].forEach(item=&gt;Vue[item+'s']=function(){})</code> 初始化全局资源注册方法 包含注册过滤器的方法 注册组件的方法 注册指令的方法</li> <li>Vue.Mixin 初始化混入方法</li> <li>Vue.use 初始化插件安装方法</li> <li>Vue.options 初始化全局 options</li> <li>extend(cpns,buildin) 将全局组件拓展到全局 options 上去 共所有子组件使用 其实是 keep-alive</li></ul> <h4 id="createpatchfunction"><a href="#createpatchfunction" class="header-anchor">#</a> createPatchFunction</h4> <p>Vue 中使用 800+行代码去创建 patch 方法，createPatchFunction 方法接受一个对象包含两个属性，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> patch <span class="token operator">=</span> <span class="token function">createPatchFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  nodeOps<span class="token operator">:</span> nodeOps<span class="token punctuation">,</span> <span class="token comment">// 节点的crud操作</span>
  modules<span class="token operator">:</span> modules<span class="token punctuation">,</span> <span class="token comment">// klass ref style transition ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>平台相关 dom 方法 nodeOps：web 平台和 weex 平台下的 dom 节点的 crud 操作不同，所以在把 vnode patch 到真实 dom 中也具有差别。</li> <li>平台相关 modules：像是 web 平台下包括 attrs class style 等等，但到了 weex 平台下，操作样式，dom 属性等等很多差异。</li></ul> <p>采用工厂方法的方式去创建一个 patch 方法，在调用 patch 前将环境变量恒定，不管对应什么平台，虽然具体实现不同，但对于 Vue 在 patch 的过程中只拿到的已经是适应平台的相关方法。</p> <h4 id="初始化-config-和校验相关-map-function"><a href="#初始化-config-和校验相关-map-function" class="header-anchor">#</a> 初始化 config 和校验相关 map-function</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  optionMergeStrategies<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> isBooleanAttr <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>
  <span class="token string">&quot;allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,&quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;default,defaultchecked,defaultmuted,defaultselected,defer,disabled,&quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,&quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,&quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;required,reversed,scoped,seamless,selected,sortable,translate,&quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot;truespeed,typemustmatch,visible&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>config 通过 Vue.config 可配置的全局配置，最核心部分是 opts 中的每个参数的合并策略。</li> <li>makeMap 举内部一个例子，Vue 为了用户可以有完全等同于原生 html 的编码体验，标记了很多内置的属性，上述代码中仅仅以 dom 中一些布尔类型的 attrs 如 checked，required 等等，该方法构建一个 map，map 中的 key 值为字符串中的每一项，value 为 true，该方法返回一个 function，用于检测传入值。 比如，var fn = makeMap('checked,required') 将构建 {checked:'true',required:'true'}，当传入一个待检测，fn('checked')就返回 true，
fn('some')返回 undefined。</li></ul> <h4 id="安装平台相关的全局指令和组件"><a href="#安装平台相关的全局指令和组件" class="header-anchor">#</a> 安装平台相关的全局指令和组件</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">extend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>directives<span class="token punctuation">,</span> platformDirectives<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">extend</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>options<span class="token punctuation">.</span>components<span class="token punctuation">,</span> platformComponents<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>拓展平台相关全局资源以供使用</p> <ul><li>directive 指令包括 v-show v-model</li> <li>components 组件包括 transition transition-group</li></ul> <h4 id="创建模版编译器-compiler"><a href="#创建模版编译器-compiler" class="header-anchor">#</a> 创建模版编译器 compiler</h4> <p>创建编译器整体流程如下：</p> <p>createCompilerCreator =&gt; createcompiler =&gt; createCompileToFunctionFn =&gt; compileToFunctions =&gt; compile =&gt; baseCompile =&gt; 真正开始编译步骤 「parse optimize generate」</p> <ul><li>createCompilerCreator 编译器工厂工厂，也就是构造了编译器的构造器，返回一个工厂函数，这个工厂函数将生成编译器。</li> <li>createcompiler 上一步骤中返回的编译器的构造器，执行得到编译器封装对象。这个方法中处理了全局的编译器配置，包括分隔符配置编译报警配置。</li> <li>createCompileToFunctionFn 对编译器做了一层简单封装，通过一个哈希表去缓存 编译器编译出来的结果，防止多次编译一个模版。返回一个模版编译器。</li> <li>compileToFunctions 编译器本体，接受用户定义的 options.template，接受配置，最终将处理 template=&gt;render 函数，内部流程是调用核心编译器，进而通过解析，优化和生成三步去完成代码生成。</li></ul> <p>vue 模版编译十分复杂和巧妙，这里通过函数柯里化去创建编译器，逐步明确环境变量，也通过闭包去维持一个缓存，提升性能。</p> <p>本章节主要描述了在 new Vue(options)之前 Vue 内部为用户做了什么准备，如果没有这部分内容，很容易在阅读理解代码的过程中产生困惑，例如有的参数怎么来的，这个东西什么时候安装上的之类的问题。本章内容有很多地方没有解开包袱，例如_render _update 配置合并 创建 patch 方法 等等等等，这些都是 vue 的核心中的核心，都会在后续的文章中仔细剖析。</p> <p>《完》</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/nodejs/nvm.html" class="prev">
        nvm 版本控制
      </a></span> <span class="next"><a href="/frontend/vue_vuex_vue-router_nuxt/vcode/2.html">
        new Vue(options) 中的options合并处理（二）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8a3e4be4.js" defer></script><script src="/assets/js/2.b1c453a7.js" defer></script><script src="/assets/js/43.f3f083c8.js" defer></script>
  </body>
</html>
